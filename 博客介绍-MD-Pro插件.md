# MD Pro - 网页文章转Markdown的Chrome扩展

## 起因

写博客的时候经常需要收集一些参考文章，但是：

- 复制粘贴格式全丢了
- 图片过几个月就404了
- 不同网站的HTML结构千奇百怪，手动整理太累
- 想要统一的Markdown格式存档

试过几个类似的工具，要么功能太简单，要么图片处理不好。干脆自己写了个扩展，顺便练练手Manifest V3和TypeScript。

## 主要功能

### 正文提取
用的Mozilla的Readability算法，能比较准确地识别出文章的主要内容，过滤掉导航栏、广告、评论这些干扰信息。

### Markdown转换
Turndown.js做HTML到Markdown的转换，基本上各种格式都能处理：标题、列表、代码块、表格什么的。会自动生成Frontmatter，包含文章标题、URL、抓取时间这些元信息。

### 图片处理
这个比较关键，提供两种方案：
- **内联模式**：图片转成Base64直接嵌入Markdown文件，单文件包含所有内容
- **ZIP模式**：图片保持原格式，和Markdown文件一起打包下载，文件更小

### 使用方式
三种触发方式随便选：
- 点击扩展图标
- 右键菜单选择"导出为Markdown"
- 快捷键 `Ctrl+Shift+Y`（Mac上是`Cmd+Shift+Y`）

### 自定义设置
- 选择图片处理模式
- 自定义文件名模板，支持`{title}`、`{date}`、`{site}`这些变量
- 可以自动清理链接中的UTM追踪参数

## 安装和使用

### 安装

目前还没上架Chrome应用商店，需要手动安装：

1. 从GitHub下载源码或者构建好的包
2. Chrome浏览器输入 `chrome://extensions/`
3. 右上角开启"开发者模式"
4. 点击"加载已解压的扩展程序"，选择项目目录

### 使用

打开任何文章页面，点击扩展图标或者用快捷键就行了。第一次使用会询问权限，主要是为了下载文件和访问页面内容。

处理完成后会自动下载，根据你的设置是单个`.md`文件或者`.zip`压缩包。

### 设置

右键扩展图标选择"选项"进入设置页面：

- **导出模式**：内联图片适合分享，ZIP包适合本地存储
- **文件命名**：可以用`{title}-{date}-{site}`这样的模板
- **链接清理**：去掉那些utm_source之类的追踪参数

## 技术细节

### 整体架构

用的Manifest V3架构，比较新：

- **Content Script**：注入到页面里提取内容
- **Service Worker**：后台处理下载什么的
- **Popup**：点击图标弹出的小窗口
- **Options**：设置页面

### 技术栈

- **TypeScript + Vite**：开发体验比较好，类型安全，热重载
- **@mozilla/readability**：正文提取，火狐开源的算法
- **turndown + turndown-plugin-gfm**：HTML转Markdown，支持GitHub风格
- **jszip**：打包ZIP文件
- **dayjs**：处理时间格式
- **dompurify**：HTML清理，安全考虑

### 权限申请

尽量最小化权限：
- `activeTab`：读取当前页面内容
- `downloads`：下载文件
- `storage`：保存设置
- `scripting`：注入脚本
- `contextMenus`：右键菜单

图片处理时会动态申请对应网站的权限，用完就释放。

## 开发

### 本地调试

```bash
npm install
npm run dev
```

然后在Chrome扩展管理页面加载项目目录就能调试了。

### 构建发布

```bash
npm run build  # 构建到dist目录
npm run zip    # 打包成zip文件
```

### 代码规范

配了ESLint + Prettier + TypeScript，基本的代码质量保证。

## 适用场景

主要是自己在用：

- **写博客时收集参考资料**：看到好文章直接转成Markdown存到本地
- **技术文档整理**：把各种在线文档统一格式保存
- **学习笔记**：重要文章离线保存，不怕链接失效

## TODO

有时间的话想加一些功能：

- 批量处理多个标签页
- 支持更多网站的特殊处理（有些网站结构比较特殊）
- 导出其他格式（PDF、Word）
- 更好的图片压缩和处理

## 开源

MIT协议，代码在Gitee上。有bug或者建议可以提issue。

---

就是这样一个小工具，解决了我自己的需求。如果你也有类似的使用场景，可以试试看。